<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Krynet | AI Communication Platform</title>
    <link rel="stylesheet" href="style.css"/>
</head>
<body>
    <header class="site-header">
        <div class="container">
            <h1 class="logo">Krynet</h1>
            <nav>
                <ul>
                    <li><a href="#intro">Intro</a></li>
                    <li><a href="#features">Features</a></li>
                    <li><a href="#spotify">Spotify</a></li>
                    <li><a href="#antivirus">Scan</a></li>
                    <li><a href="#upscaling">Upscaling</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="container">
        <section id="intro" class="card">
            <h2>Welcome to Krynet</h2>
            <p>The future of communication. Fast, secure, AI-moderated, and free from bloat.</p>
        </section>

        <section id="features" class="card">
            <h2>Features</h2>
            <ul class="features-list">
                <li>‚ö° Instant Communication</li>
                <li>ü§ñ AI Moderation Engine</li>
                <li>üõ°Ô∏è Built-in Antivirus Scanner</li>
                <li>üéß Spotify Integration (Music Support Only)</li>
                <li>üéÆ Steam Store Integration</li>
                <li>üîí HEIF, HE-AAC, AVIF Only</li>
                <li>üìÅ Media Embeds with AVIF/HEIF/HE-AAC</li>
                <li>üì° 100% API-Driven Infrastructure</li>
                <li>üì∫ AI-Based Video Upscaling (GPU-aware)</li>
                <li>üß† All uploads are AI-scanned, format-verified, and deleted if malicious</li>
            </ul>
        </section>

        <section id="spotify" class="card">
            <h2>Spotify Now Playing</h2>
            <button id="loginSpotify">Login with Spotify</button>
            <div id="nowPlaying" class="now-playing"></div>
        </section>

        <section id="antivirus" class="card">
            <h2>Upload File for Virus Scan</h2>
            <form id="uploadForm">
                <input type="file" id="fileInput" required />
                <button type="submit">Upload & Scan</button>
            </form>
            <pre id="uploadResult"></pre>
        </section>

        <section id="upscaling" class="card">
            <h2>Video Upscaling</h2>
            <p>GPU Detected: <span id="gpuVendor">Detecting...</span></p>
            <p><strong>Note:</strong> AI video enhancement only works with NVIDIA, AMD, or Intel GPUs.</p>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 Krynet. Powered by APIs. Inspired by progress.</p>
        </div>
    </footer>

    <script>
        // Spotify Auth
        const clientId = '1wb6zpqvawgruzzali70rnwql';
        const redirectUri = window.location.origin;
        const scopes = 'user-read-playback-state user-read-currently-playing';

        document.getElementById('loginSpotify').addEventListener('click', () => {
            const authUrl = `https://accounts.spotify.com/authorize?response_type=token&client_id=${clientId}&scope=${scopes}&redirect_uri=${redirectUri}`;
            window.location = authUrl;
        });

        window.addEventListener('load', () => {
            const hash = window.location.hash.substring(1);
            const hashParams = {};
            hash.split('&').forEach(param => {
                const [key, value] = param.split('=');
                if (key && value) hashParams[key] = decodeURIComponent(value);
            });

            const accessToken = hashParams['access_token'];

            if (accessToken) {
                fetch('https://api.spotify.com/v1/me/player/currently-playing', {
                    headers: { Authorization: `Bearer ${accessToken}` }
                })
                .then(res => res.json())
                .then(data => {
                    const nowPlaying = document.getElementById('nowPlaying');
                    if (data?.item) {
                        nowPlaying.innerHTML = `<p><strong>${data.item.name}</strong> by ${data.item.artists.map(a => a.name).join(', ')}</p><img src="${data.item.album.images[0].url}" width="100" alt="Album Art">`;
                    } else {
                        nowPlaying.textContent = 'No track currently playing.';
                    }
                })
                .catch(err => {
                    document.getElementById('nowPlaying').textContent = 'Error fetching Spotify data: ' + err;
                });
            }

            // GPU Detection
            const canvas = document.createElement('canvas');
            const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
            const debugInfo = gl?.getExtension('WEBGL_debug_renderer_info');
            const vendor = debugInfo ? gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL) : 'Unavailable';
            const gpuVendor = /NVIDIA/i.test(vendor) ? 'NVIDIA' : /AMD|Radeon/i.test(vendor) ? 'AMD' : /Intel/i.test(vendor) ? 'Intel' : 'Other';
            document.getElementById('gpuVendor').textContent = vendor || gpuVendor;
        });

        // Upload & Scan File
        document.getElementById('uploadForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const file = document.getElementById('fileInput').files[0];
            const result = document.getElementById('uploadResult');

            if (!file) return (result.textContent = 'No file selected.');

            const formData = new FormData();
            formData.append('file', file);

            try {
                const response = await fetch('https://www.virustotal.com/api/v3/files', {
                    method: 'POST',
                    headers: {
                        'x-apikey': ''
                    },
                    body: formData
                });
                const data = await response.json();
                result.textContent = JSON.stringify(data, null, 2);
            } catch (err) {
                result.textContent = 'Error uploading file: ' + err.message;
            }
        });
    </script>
</body>
</html>
