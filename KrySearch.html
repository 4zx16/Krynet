<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>KrySearch – Krynet Edition</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">
<style>
body { margin:0; height:100vh; display:flex; justify-content:center; align-items:center; background:#0d0d0d; color:#fff; font-family:system-ui,sans-serif;}
.box { background:#161616; padding:32px; border-radius:16px; max-width:480px; width:100%; text-align:center; box-shadow:0 20px 50px rgba(0,0,0,0.6);}
h1 { margin:0 0 12px; font-size:1.8rem; color:#4da6ff; }
p { margin:0 0 18px; font-size:.95rem; opacity:.8; }
input, button { width:100%; padding:12px; margin-bottom:14px; border-radius:10px; border:none; font-size:1rem; }
input { background:#0b0b0b; color:#fff; }
button { background:#4da6ff; color:#000; font-weight:700; cursor:pointer; }
button:hover { background:#3399ff; }
.note { font-size:.8rem; opacity:.6; }
</style>
</head>
<body>
<div class="box">
<h1>KrySearch</h1>
<p>Privacy-first search by Krynet. JS optional, Tor-aware.</p>
<form id="searchForm" action="https://www.startpage.com/sp/search" method="get" autocomplete="off">
  <input id="searchInput" name="query" type="text" placeholder="Search or enter a URL…" required>
  <button type="submit">Go</button>
</form>
<div class="note">Privacy-maximized · JS optional · Onion-aware · Krynet Edition</div>
</div>

<script>
window.addEventListener('DOMContentLoaded', () => {
  const params = new URLSearchParams(window.location.search);
  const engine = (params.get('engine')||'startpage').toLowerCase();
  const q = params.get('q');
  const url = params.get('url');
  const postOnly = params.get('post')==='1';
  const inputEl = document.getElementById('searchInput');

  const TOR_DDG_ONION = 'http://duckduckgogg42xjoc72x3sjasowoarfbgcmvfimaftt6twagswzczad.onion/';
  const TOR_SEARX_ONION = 'http://searxngf7j4f.onion/';
  const isTor = navigator.userAgent.includes('Tor');

  const sanitize = str => { const d=document.createElement('div'); d.textContent=str; return d.textContent; };
  inputEl.value = q || url || '';

  const getEngineURL = () => {
    switch(engine){
      case 'searx': return isTor ? TOR_SEARX_ONION : 'https://searxng.org/';
      case 'ddg': return isTor ? TOR_DDG_ONION : 'https://duckduckgo.com/';
      case 'brave': return 'https://search.brave.com/search';
      case 'startpage':
      default: return 'https://www.startpage.com/sp/search';
    }
  };

  const getQueryName = () => engine==='startpage'?'query':'q';

  const perform = val => {
    if(!val) return;
    const base = getEngineURL();
    const paramName = getQueryName();
    const sanitized = sanitize(val);

    // Use POST for SearXNG/DDG if requested
    if(postOnly && (engine==='searx'||engine==='ddg')){
      const f = document.createElement('form');
      f.method='POST'; f.action=base; f.target='_blank';
      const i = document.createElement('input');
      i.type='hidden'; i.name=paramName; i.value=sanitized;
      f.appendChild(i);
      document.body.appendChild(f);
      f.submit();
      f.remove();
    } else {
      const paramsObj = new URLSearchParams();
      paramsObj.set(paramName, sanitized);
      window.open(base+'?'+paramsObj.toString(), '_blank','noopener,noreferrer');
    }
  };

  // Auto-run on page load
  if(q) perform(q);
  else if(url) perform(url);

  // Manual fallback
  document.getElementById('searchForm').addEventListener('submit', e=>{
    e.preventDefault();
    perform(inputEl.value.trim());
  });
});
</script>
</body>
</html>
