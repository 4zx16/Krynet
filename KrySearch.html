<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>KrySearch – Krynet Edition</title>

<meta http-equiv="Content-Security-Policy"
  content="
    default-src 'none';
    script-src 'self';
    style-src 'self' 'unsafe-inline';
    img-src 'self' data:;
    form-action
      https://searxng.org
      https://duckduckgo.com
      https://www.startpage.com
      https://search.brave.com
      http://searxngf7j4f.onion
      http://duckduckgogg42xjoc72x3sjasowoarfbgcmvfimaftt6twagswzczad.onion;
    base-uri 'none';
    frame-ancestors 'none';
    object-src 'none';
  ">
<meta name="referrer" content="no-referrer">
<meta http-equiv="Permissions-Policy"
  content="
    geolocation=(),
    camera=(),
    microphone=(),
    payment=(),
    usb=(),
    bluetooth=(),
    accelerometer=(),
    gyroscope=()
  ">
<meta http-equiv="x-dns-prefetch-control" content="off">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin:0; height:100vh;
  display:flex; justify-content:center; align-items:center;
  background:#0d0d0d; color:#fff; font-family:system-ui,sans-serif;
}
.box {
  background:#161616; padding:32px; border-radius:16px; max-width:480px; width:100%; text-align:center;
  box-shadow:0 20px 50px rgba(0,0,0,0.6);
}
h1 { margin:0 0 12px; font-size:1.8rem; color:#4da6ff; }
p { margin:0 0 18px; font-size:.95rem; opacity:.8; }
input, button { width:100%; padding:12px; margin-bottom:14px; border-radius:10px; border:none; font-size:1rem; }
input { background:#0b0b0b; color:#fff; }
button { background:#4da6ff; color:#000; font-weight:700; cursor:pointer; }
button:hover { background:#3399ff; }
.note { font-size:.8rem; opacity:.6; }
</style>
</head>
<body>

<div class="box">
  <h1>KrySearch</h1>
  <p>Privacy-first search by Krynet. JS optional, Tor-aware.</p>

  <!-- Fallback HTML form for JS-disabled users -->
  <form id="fallbackForm" action="https://www.startpage.com/sp/search" method="get" autocomplete="off" referrerpolicy="no-referrer">
    <input id="fallbackInput" name="query" type="text" placeholder="Search or enter a URL…" required
      autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
    <button type="submit">Go</button>
  </form>

  <div class="note">Privacy-maximized · JS optional · Onion-aware · Krynet Edition</div>
</div>

<script>
(function(){
  const params = new URLSearchParams(window.location.search);
  const engine = (params.get('engine')||'startpage').toLowerCase();
  const query = params.get('q')||'';
  const urlParam = params.get('url')||'';
  const postOnly = params.get('post')==='1';

  const TOR_DDG_ONION = 'http://duckduckgogg42xjoc72x3sjasowoarfbgcmvfimaftt6twagswzczad.onion/';
  const TOR_SEARX_ONION = 'http://searxngf7j4f.onion/';
  const isTor = navigator.userAgent.includes('Tor');

  const sanitize = str => { const div=document.createElement('div'); div.textContent=str; return div.textContent; };
  const isURL = v => { try { v=sanitize(v); if(!/^[a-zA-Z][a-zA-Z\d+-.]*:/.test(v)) v='https://'+v; new URL(v); return true; } catch { return false; } };

  const fallbackInput = document.getElementById('fallbackInput');
  fallbackInput.value = urlParam || query || '';

  const perform = val => {
    if(!val) return;

    let targetUrl='', name='q';
    switch(engine){
      case 'searx': targetUrl = isTor?TOR_SEARX_ONION:'https://searxng.org/'; break;
      case 'ddg': targetUrl = isTor?TOR_DDG_ONION:'https://duckduckgo.com/'; break;
      case 'startpage': targetUrl = 'https://www.startpage.com/sp/search'; name='query'; break;
      case 'brave': targetUrl = 'https://search.brave.com/search'; break;
      default: targetUrl='https://www.startpage.com/sp/search'; name='query';
    }

    if(isURL(val)){
      window.open(val.startsWith('http')?val:'https://'+val,'_blank','noopener,noreferrer');
      return;
    }

    if(postOnly && (engine==='searx' || engine==='ddg')){
      const f = document.createElement('form');
      f.method='POST'; f.action=targetUrl; f.target='_blank';
      const i = document.createElement('input'); i.type='hidden'; i.name=name; i.value=sanitize(val);
      f.appendChild(i); document.body.appendChild(f); f.submit(); f.remove();
    } else {
      const params = new URLSearchParams(); params.set(name,sanitize(val));
      window.open(targetUrl+'?'+params.toString(),'_blank','noopener,noreferrer');
    }
  };

  // Auto-run: search query takes priority, fallback to URL
  if(query) perform(query);
  else if(urlParam) perform(urlParam);

  // Override fallback form submit
  const fallbackForm = document.getElementById('fallbackForm');
  fallbackForm.addEventListener('submit', e=>{
    e.preventDefault();
    perform(fallbackInput.value);
  });
})();
</script>

</body>
</html>
